<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sää</title>

    <link href="styles.css" rel="stylesheet">

    <!-- Latest compiled and minified CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Latest compiled JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        //Hae tiedot api-rajapinnasta fetch-toiminnolla
        //Jos haku onnistuu, muuta saatu response json-muotoon
        //Välitä json data funktiolle käsiteltäväksi
        //Jos tuli virhe, näytä virheviesti catch-osiossa
        fetch("https://api.openweathermap.org/data/2.5/weather?id=658225&appid=665ecd56dfc08dbb50feb8b8f5034e28&lang=fi&units=metric")
            .then(response => response.json())
            .then(data => naytaSaatiedot(data))
            .catch(error => { document.getElementById("saaTiedot").innerHTML = "Säätietoja ei voitu hakea"; })


        function naytaSaatiedot(saaData) {

            //Hae tämän hetken aika
            //Hae kuluva päivämäärä, josta saa haettua ajan
            const pvm = new Date();
            //Hae tunnit
            const tunnit = pvm.getHours();
            //Hae minuutit
            const minuutit = pvm.getMinutes();

            //Tallenna haetusta säädatasta halutut tiedot
            let saa = saaData.weather[0].description;
            let lampotila = saaData.main.temp;
            let tuuli = saaData.wind.speed;

            //Kuva on jsonissa weather-taulukossa avaimella "icon"
            //En saanut toimimaan weatherAPI:n dokumentaatiossa olevaa ikonin url-linkkiä: https://openweathermap.org/weather-conditions#Weather-Condition-Codes-2
            //Etsin vaihtoehtoisen ikonilinkin Stack overflowsta: https://stackoverflow.com/questions/44177417/how-to-display-openweathermap-weather-icon
            kuvaUrl = "http://openweathermap.org/img/w/" + saaData.weather[0].icon + ".png";

            //Aseta aika ja haetut tiedot html-elementteihin ja html-tiedostoon
            let tiedot = "<p>Sää kello " + tunnit + ":" + minuutit + "</p> <h2>Sää:</h2> <h3>" + saa + "</h3> <h2>Lämpötila:</h2><h3>" + lampotila + "</h3> <h2>Tuuli:</h2><h3>" + tuuli + " m/s</h3>";

            tiedot += "<img src=" + kuvaUrl + ">";

            document.getElementById("saaTiedot").innerHTML = tiedot;
        }
    </script>
</head>

<body>
    <!--Navigaatio-->
    <nav class="navbar navbar-expand-sm navbar-custom">
        <div class="container-fluid">
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#collapsibleNavbar">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="collapsibleNavbar">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">Etusivu (Tehtävä 1: osa 1)</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="toteutus.html">Tehtävä 1: osa 2</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="poke.html">Poke haku (Tehtävä 2: osa 1)</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="kaannaPoke.html">Poke haku (Tehtävä 2: osa 2)</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="saa.html">Tehtävä 3</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!--Haetut tiedot asetetaan diviin jonka id on saaTiedot-->
    <main>
        <div id="saaOsio">
            <h1>Sää Helsingissä</h1>
            <div id="saaTiedot"></div>
        </div>
    </main>
</body>

</html>